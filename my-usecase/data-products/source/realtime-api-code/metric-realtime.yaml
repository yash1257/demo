name: realtime-metric-api
version: v1
type: workflow
tags:
  - realtime-api
  - nilus_batch
  - realtime-metric
workspace: ${WORKSPACENAME}                  # Change this to your workspace name
workflow:
  # schedule:
  #   cron: '*/60 * * * *'                     # Every 60 minutes â€” change frequency here
  #   concurrencyPolicy: Forbid
  dag:
    - name: realtime-metric-dag
      spec:
        stack: nilus:1.0
        compute: ${COMPUTENAME}              # Change to your compute environment name
        resources:
          requests:
            cpu: 500m
            memory: 512Mi
        logLevel: INFO
        dataosSecrets:
          - name: weather-api-cred           # Replace with the secret name created for the Weather API           
            allKeys: true
            consumptionType: envVars
          - name: ${GITSECRETNAME}           # Replace with Git credentials secret name
            allKeys: true
            consumptionType: envVars
        stackSpec:
          repo:
            url: "https://github.com/yash1257/demo"      # Replace with your repository URL if different
            syncFlags:
              - '--ref=main' 
            baseDir: "demo/my-usecase/data-products/source/realtime-api-code"    # Directory path inside the repo where your code resides
                                                                              # Change this if your code structure or folder path changes
          source:
            address: "custom://WeatherRealtimeApiSource?url=https://api.tomorrow.io/v4/weather/realtime?location=12.9155151,77.6158726&units=metric&apikey={API_KEY}"
            options:
              source-table: "realtime_metric"            # table name for source data
          sink:
            address: dataos://lakehouse?acl=rw          # Destination (Lakehouse)
            options:
              dest-table: "nilus"                    # Schema name 
              incremental-strategy: append  
